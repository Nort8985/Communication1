<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Современная платформа для общения и обсуждений">
    <meta name="theme-color" content="#6366f1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="msapplication-tap-highlight" content="no">

    <!-- PWA Манифест -->
    <link rel="manifest" href="manifest.json">

    <!-- Иконки для PWA -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512x512.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">

    <title>DevTalk - Современная платформа общения</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="style.css">

    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('✅ SW registered'))
                    .catch(error => console.log('❌ SW registration failed'));
            });
        }
    </script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner">
                <div class="spinner"></div>
            </div>
            <h2>DevTalk</h2>
            <p>Загрузка...</p>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notifications" class="notifications"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <!-- Mobile Menu Button -->
            <button class="mobile-menu-btn" id="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>

            <!-- Logo -->
            <div class="logo" onclick="scrollToTop()">
                <div class="logo-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <span class="logo-text">DevTalk</span>
            </div>

            <!-- Search -->
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Поиск по постам..." onkeydown="handleSearch(event)">
                    <div class="search-suggestions" id="search-suggestions"></div>
                </div>
            </div>

            <!-- Header Actions -->
            <div class="header-actions">
                <!-- Stats (Desktop) -->
                <div class="stats-bar desktop-only">
                    <div class="stat-item">
                        <i class="fas fa-users"></i>
                        <span id="active-users">0</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-circle online-dot"></i>
                        <span id="online-count">0</span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <button class="action-btn theme-btn" id="theme-btn" title="Сменить тему">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>

                <button class="action-btn notifications-btn" id="notifications-btn">
                    <i class="fas fa-bell"></i>
                    <span class="badge" id="notification-badge">0</span>
                </button>

                <button class="action-btn chats-btn" id="chats-btn" title="Чаты">
                    <i class="fas fa-comments"></i>
                </button>

                <button class="action-btn create-btn" id="create-btn" title="Создать пост">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-overlay" id="mobile-overlay"></div>

    <!-- Mobile Menu -->
    <nav class="mobile-menu" id="mobile-menu">
        <div class="mobile-menu-header">
            <h3>Меню</h3>
            <button class="close-btn" id="close-mobile-menu">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="mobile-menu-content">
            <!-- User Section -->
            <div class="mobile-user-section">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-info">
                    <input type="text" id="mobile-username" placeholder="Ваше имя" maxlength="20" class="mobile-username-input">
                    <button class="confirm-username-btn" id="mobile-confirm-username" style="display: none;">
                        <i class="fas fa-check"></i> Подтвердить
                    </button>
                </div>
            </div>

            <!-- Stats -->
            <div class="mobile-stats">
                <div class="stat-item">
                    <i class="fas fa-users"></i>
                    <span>Пользователей: <strong id="users-count-mobile">0</strong></span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-circle online-dot"></i>
                    <span>Онлайн: <strong id="online-count-mobile">0</strong></span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-file-alt"></i>
                    <span>Постов: <strong id="posts-count-mobile">0</strong></span>
                </div>
            </div>

            <!-- Sort Options -->
            <div class="mobile-sort">
                <h4><i class="fas fa-sort"></i> Сортировка</h4>
                <div class="sort-buttons">
                    <button class="sort-btn active" onclick="sortPosts('new'); closeMobileMenu();">
                        <i class="fas fa-clock"></i> Новые
                    </button>
                    <button class="sort-btn" onclick="sortPosts('hot'); closeMobileMenu();">
                        <i class="fas fa-fire"></i> Популярные
                    </button>
                    <button class="sort-btn" onclick="sortPosts('top'); closeMobileMenu();">
                        <i class="fas fa-arrow-up"></i> Топ
                    </button>
                </div>
            </div>

            <!-- Admin Panel (if admin) -->
            <div class="mobile-admin" id="mobile-admin-section" style="display: none;">
                <button class="admin-btn" onclick="openAdminPanel(); closeMobileMenu();">
                    <i class="fas fa-shield-alt"></i> Админ-панель
                </button>
            </div>

            <!-- Rules -->
            <div class="mobile-rules">
                <h4><i class="fas fa-book"></i> Правила</h4>
                <ul>
                    <li>Будьте вежливы и уважительны</li>
                    <li>Не спамьте и не флудите</li>
                    <li>Избегайте оскорблений</li>
                    <li>Соблюдайте тему обсуждения</li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <main class="main-container">
        <!-- Sidebar (Desktop) -->
        <aside class="sidebar desktop-only">
            <!-- Create Post Card -->
            <div class="create-post-card">
                <div class="user-section">
                    <div class="user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-input-section">
                        <input type="text" id="username" placeholder="Ваше имя" maxlength="20" class="username-input">
                        <button class="confirm-username-btn" id="confirm-username" style="display: none;">
                            <i class="fas fa-check"></i>
                        </button>
                    </div>
                </div>
                <button class="create-post-btn" onclick="openPostModal()">
                    <i class="fas fa-plus"></i>
                    <span>Создать пост</span>
                </button>
            </div>

            <!-- Sort Options -->
            <div class="sidebar-section">
                <h3><i class="fas fa-sort"></i> Сортировка</h3>
                <div class="sort-buttons">
                    <button class="sort-btn active" onclick="sortPosts('new')">
                        <i class="fas fa-clock"></i> Новые
                    </button>
                    <button class="sort-btn" onclick="sortPosts('hot')">
                        <i class="fas fa-fire"></i> Популярные
                    </button>
                    <button class="sort-btn" onclick="sortPosts('top')">
                        <i class="fas fa-arrow-up"></i> Топ
                    </button>
                </div>
            </div>

            <!-- Stats -->
            <div class="sidebar-section stats-section">
                <h3><i class="fas fa-chart-bar"></i> Статистика</h3>
                <div class="stats-list">
                    <div class="stat-item">
                        <span class="stat-label">Постов</span>
                        <span class="stat-value" id="posts-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Пользователей</span>
                        <span class="stat-value" id="users-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Онлайн</span>
                        <span class="stat-value" id="online-count-sidebar">0</span>
                    </div>
                </div>
            </div>

            <!-- Admin Panel Button -->
            <div class="sidebar-section" id="admin-sidebar" style="display: none;">
                <button class="admin-btn" onclick="openAdminPanel()">
                    <i class="fas fa-shield-alt"></i> Админ-панель
                </button>
            </div>
        </aside>

        <!-- Content -->
        <div class="content">
            <!-- Posts Container -->
            <div id="posts-container" class="posts-container">
                <!-- Posts will be loaded here -->
            </div>

            <!-- Loading Indicator -->
            <div id="loading-posts" class="loading-posts">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
                <p>Загрузка постов...</p>
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="empty-state" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <h3>Пока нет постов</h3>
                <p>Будьте первым! Создайте интересный пост для обсуждения.</p>
                <button class="create-first-post-btn" onclick="openPostModal()">
                    <i class="fas fa-plus"></i> Создать первый пост
                </button>
            </div>
        </div>
    </main>

    <!-- Floating Action Button (Mobile) -->
    <button class="fab" id="fab" onclick="openPostModal()">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Modals -->

    <!-- Post Modal -->
    <div id="post-modal" class="modal">
        <div class="modal-backdrop" onclick="closePostModal()"></div>
        <div class="modal-content post-modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Создать пост</h2>
                <button class="modal-close" onclick="closePostModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="post-title">Заголовок</label>
                    <input type="text" id="post-title" placeholder="О чём вы хотите поговорить?" maxlength="100">
                </div>
                <div class="form-group">
                    <label for="post-text">Содержание (необязательно)</label>
                    <textarea id="post-text" placeholder="Расскажите подробнее..." rows="6"></textarea>
                </div>
                <div class="form-actions">
                    <button class="btn-secondary" onclick="closePostModal()">Отмена</button>
                    <button class="btn-primary" onclick="submitPost()">
                        <i class="fas fa-paper-plane"></i> Опубликовать
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chats Modal -->
    <div id="chats-modal" class="modal">
        <div class="modal-backdrop" onclick="closeChatsModal()"></div>
        <div class="modal-content chats-modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-comments"></i> Личные чаты</h2>
                <button class="modal-close" onclick="closeChatsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="chats-layout">
                    <!-- Chats List -->
                    <div class="chats-sidebar">
                        <div class="chats-header">
                            <h3>Ваши чаты</h3>
                            <button class="new-chat-btn" onclick="openNewChatModal()">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="chats-list" class="chats-list">
                            <!-- Chats will be loaded here -->
                        </div>
                    </div>

                    <!-- Chat Window -->
                    <div class="chat-window" id="chat-window">
                        <div class="chat-placeholder">
                            <div class="placeholder-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <h3>Выберите чат</h3>
                            <p>Выберите чат из списка или создайте новый</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Chat Modal -->
    <div id="new-chat-modal" class="modal">
        <div class="modal-backdrop" onclick="closeNewChatModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-plus"></i> Новый чат</h2>
                <button class="modal-close" onclick="closeNewChatModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="chat-participant">Имя пользователя</label>
                    <input type="text" id="chat-participant" placeholder="Введите имя пользователя">
                </div>
                <div class="form-actions">
                    <button class="btn-secondary" onclick="closeNewChatModal()">Отмена</button>
                    <button class="btn-primary" onclick="createNewChat()">
                        <i class="fas fa-plus"></i> Создать чат
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="admin-modal" class="modal">
        <div class="modal-backdrop" onclick="closeAdminPanel()"></div>
        <div class="admin-modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-shield-alt"></i> Админ-панель</h2>
                <button class="modal-close" onclick="closeAdminPanel()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Admin navigation and content will be loaded here -->
                <div id="admin-content"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="app.js"></script>
</body>
</html>
